<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MyAutoSound</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
    body { font-family: "Poppins", sans-serif; }
    button { transition: all 0.3s ease; }
    button:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
    @keyframes micSpin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .fade-slide-up { animation: fadeSlideUp 0.6s ease forwards; }
    @keyframes fadeSlideUp { 0%{opacity:0;transform:translateY(15px);} 100%{opacity:1;transform:translateY(0);} }
    .fade-in { animation: fadeIn 0.5s ease forwards; }
    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
  </style>
</head>
<body class="min-h-screen bg-gray-100 bg-opacity-90 text-gray-800">

<!-- Navigation Header -->
<header class="bg-white shadow-md sticky top-0 z-50">
  <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
    <div class="text-xl font-bold text-blue-600">MyAutoSound</div>
    <nav class="space-x-6 text-sm md:text-base">
      <a href="#diagnosisForm" class="text-gray-700 hover:text-blue-600">Diagnose</a>
      <a href="#about" class="text-gray-700 hover:text-blue-600">About</a>
      <a href="#history" class="text-gray-700 hover:text-blue-600">History</a>
      <a href="tutorials.html" class="text-gray-700 hover:text-blue-600">Tutorials</a>
    </nav>
  </div>
</header>

<!-- HERO -->
<section class="relative bg-[url('https://images.unsplash.com/photo-1583126162406-643011b3f69f?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.1.0')] bg-center bg-no-repeat bg-cover">
  <div class="absolute inset-0 bg-gradient-to-b from-black/60 via-black/45 to-black/60"></div>

  <div class="relative z-10 max-w-6xl mx-auto px-6 py-20 md:py-28 text-white">
    <div class="max-w-2xl">
      <h1 class="text-3xl md:text-5xl font-extrabold leading-tight">
        Fix it yourself. Verify the problem.
        <span class="text-blue-300">Walk into a shop with confidence.</span>
      </h1>

      <p class="mt-4 text-lg md:text-xl text-gray-100/90">
        Describe or record the sound and we‚Äôll suggest likely causes, the checks you can do at home, and when it‚Äôs worth seeing a mechanic ‚Äî so you don‚Äôt pay for guesswork.
      </p>

      <div class="mt-5 grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-3 py-2 rounded-lg text-sm">üß∞ DIY checklists & simple tools</div>
        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-3 py-2 rounded-lg text-sm">üîá Works even without audio</div>
        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-3 py-2 rounded-lg text-sm">üíµ Cost ranges & urgency level</div>
        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur px-3 py-2 rounded-lg text-sm">üß™ Free during beta</div>
      </div>

      <p class="mt-6 text-xs text-gray-200/80">
        MyAutoSound is not a substitute for a professional inspection. We help you perform checks at home and talk to mechanics with facts.
      </p>
    </div>
  </div>
</section>

<!-- üõà Diagnostic Tips -->
<section class="max-w-4xl mx-auto bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-md shadow mb-8 mt-12">
  <h2 class="text-xl font-bold text-yellow-800 mb-2">üí° How to Get the Most Accurate Diagnosis</h2>
  <ul class="list-disc list-inside text-gray-700 space-y-1">
    <li>The more detailed information you provide, the more accurate the results will be.</li>
    <li>Describe the noise, where it comes from, and under what conditions it occurs.</li>
    <li>You can also upload an audio recording of the noise if possible.</li>
    <li>The diagnosis can be made <strong>even without sound</strong> by filling out the other fields.</li>
    <li>If you‚Äôre unsure of the exact term, use simple words (e.g., ‚Äúclunk‚Äù, ‚Äúwhistle‚Äù).</li>
  </ul>
</section>

<!-- Diagnostic Section -->
<section id="diagnose" class="py-16 px-6">
  <div class="max-w-7xl mx-auto">

    <h2 class="text-3xl font-bold text-center mb-10">Car Sound Diagnostic</h2>

    <form id="diagnosisForm" enctype="multipart/form-data">

      <!-- Step Section with background (MASONRY) -->
      <section
        class="relative w-full py-12 rounded-3xl overflow-hidden"
        style="
          background-image: url('https://images.unsplash.com/photo-1493305457700-d3d24daf8c8c?q=80&w=687&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
        "
      >
        <div class="absolute inset-0 bg-black bg-opacity-40 pointer-events-none"></div>

        <!-- üß± Masonry: 1 colonne mobile, 2 colonnes md+ -->
        <div class="relative px-6 z-10 md:columns-2 md:[column-gap:2rem]">

          <!-- Step 1 -->
          <div class="break-inside-avoid bg-white/80 backdrop-blur-md p-8 rounded-2xl shadow-xl mb-8">
            <h2 class="text-2xl font-bold text-blue-700 mb-6 flex items-center gap-2">
              üìù Step 1 ‚Äì Describe the Sound
            </h2>

            <!-- Description -->
            <div class="mb-6">
              <label for="textInput" class="block mb-2 font-semibold">Describe the noise:</label>
              <input
                type="text"
                id="textInput"
                name="description"
                placeholder="e.g. squealing when turning"
                class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400"
              />
            </div>

            <!-- Audio Recording -->
            <div class="mb-6">
              <label for="recordButton" class="block mb-2 font-semibold">Record the sound:</label>
              <button
                id="recordButton"
                type="button"
                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow-md transition"
              >
                üé§ Start Recording
              </button>
              <audio id="recordedAudio" controls class="hidden mt-4 w-full"></audio>
              <p id="recordingStatus" class="mt-2 text-sm text-gray-600"></p>
            </div>

            <!-- File Upload -->
            <div class="mb-6">
              <label for="audioFile" class="block mb-2 font-semibold">Choose a file:</label>
              <input
                type="file"
                id="audioFile"
                name="audio"
                accept="audio/*"
                class="block w-full text-sm text-gray-800 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-white file:bg-blue-600 hover:file:bg-blue-700"
              />
            </div>

            <!-- Example Sounds -->
            <details class="mt-6">
              <summary class="cursor-pointer text-blue-700 font-semibold text-lg mb-2">
                Example Sounds ‚ñº
              </summary>
              <div class="mt-4 space-y-4 max-h-72 overflow-y-auto pr-2">
                <div class="flex items-center space-x-3">
                  <label class="w-56 font-semibold">Clunking:</label>
                  <audio controls class="w-full">
                    <source src="Sounds/AutoSound_Example_Sounds/clunking.mp3" type="audio/mpeg" />
                  </audio>
                </div>
                <div class="flex items-center space-x-3">
                  <label class="w-56 font-semibold">Squealing:</label>
                  <audio controls class="w-full">
                    <source src="Sounds/AutoSound_Example_Sounds/squealing.mp3" type="audio/mpeg" />
                  </audio>
                </div>
                <div class="flex items-center space-x-3">
                  <label class="w-56 font-semibold">Grinding:</label>
                  <audio controls class="w-full">
                    <source src="Sounds/AutoSound_Example_Sounds/grinding.mp3" type="audio/mpeg" />
                  </audio>
                </div>
                <div class="flex items-center space-x-3">
                  <label class="w-56 font-semibold">Ticking:</label>
                  <audio controls class="w-full">
                    <source src="Sounds/AutoSound_Example_Sounds/ticking.mp3" type="audio/mpeg" />
                  </audio>
                </div>
                <div class="flex items-center space-x-3">
                  <label class="w-56 font-semibold">Rattling:</label>
                  <audio controls class="w-full">
                    <source src="Sounds/AutoSound_Example_Sounds/rattling.mp3" type="audio/mpeg" />
                  </audio>
                </div>
              </div>
            </details>
          </div>

          <!-- Step 2 -->
          <div class="break-inside-avoid bg-white/80 backdrop-blur-md p-8 rounded-2xl shadow-xl mb-8">
            <div class="flex items-center gap-3 mb-3">
              <span class="inline-flex items-center rounded-full bg-blue-50 text-blue-700 px-3 py-1 text-xs font-semibold">Step 2</span>
              <h2 class="text-2xl font-bold text-blue-700 flex items-center gap-2">üìç Provide more details</h2>
            </div>

            <!-- WHERE -->
            <div class="mb-6">
              <label for="location" class="block mb-2 font-semibold">Where is the sound coming from?</label>
              <select
                id="location"
                name="location"
                class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400"
              >
                <option>Front Left</option>
                <option>Front Right</option>
                <option>Rear Left</option>
                <option>Rear Right</option>
                <option>Engine</option>
                <option>Under the Car</option>
                <option>Dashboard</option>
                <option>Not sure</option>
              </select>
            </div>

            <!-- WHEN (primary) -->
            <div class="mb-6">
              <label for="situation" class="block mb-2 font-semibold">Primary situation (most frequent):</label>
              <select
                id="situation"
                name="situation"
                class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400"
              >
                <option>At startup</option>
                <option>While accelerating</option>
                <option>While braking</option>
                <option>While turning</option>
                <option>At idle</option>
                <option>After a speed bump</option>
                <option>On rough roads</option>
                <option>With A/C ON</option>
              </select>
            </div>

            <!-- WHEN (secondary multi) -->
            <div class="mb-6">
              <p class="block mb-2 font-semibold">When does it happen? (select all that apply)</p>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
                <label class="flex items-center gap-2"><input type="checkbox" name="when" value="Cold start"> Cold start</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="when" value="Hot engine"> Hot engine</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="when" value="Cruising"> Cruising</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="when" value="Reversing"> Reversing</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="when" value="Turning"> Turning</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="when" value="Braking"> Braking</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="when" value="Accelerating"> Accelerating</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="when" value="Over bumps"> Over bumps</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="when" value="Wet conditions"> Wet conditions</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="when" value="AC on"> A/C ON</label>
              </div>
            </div>

            <!-- SOUND PROFILE -->
            <div class="mb-6">
              <p class="block mb-2 font-semibold">How would you describe the sound? (select all that apply)</p>
              <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm">
                <label class="flex items-center gap-2"><input type="checkbox" name="soundType" value="Squeal"> Squeal</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="soundType" value="Whine"> Whine</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="soundType" value="Knock"> Knock</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="soundType" value="Tick"> Tick</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="soundType" value="Rattle"> Rattle</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="soundType" value="Grind"> Grind</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="soundType" value="Hiss"> Hiss</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="soundType" value="Click"> Click</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="soundType" value="Hum"> Hum</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="soundType" value="Clunk"> Clunk</label>
                <label class="flex items-center gap-2"><input type="checkbox" name="soundType" value="Pop"> Pop</label>
              </div>
            </div>

            <div class="grid sm:grid-cols-3 gap-6 mb-6">
              <div>
                <label class="block mb-2 font-semibold">Rhythm</label>
                <select id="rhythm" name="rhythm" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400">
                  <option>Constant</option>
                  <option>Intermittent</option>
                  <option>With vehicle speed</option>
                  <option>With engine RPM</option>
                  <option>On/off with steering</option>
                </select>
              </div>
              <div>
                <label class="block mb-2 font-semibold">Duration</label>
                <select id="duration" name="duration" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400">
                  <option>&lt; 1 sec (brief)</option>
                  <option>1‚Äì3 sec (short)</option>
                  <option>&gt; 3 sec (sustained)</option>
                  <option>Continuous</option>
                </select>
              </div>
              <div>
                <label class="block mb-2 font-semibold">Speed range</label>
                <select id="speedRange" name="speedRange" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400">
                  <option>0‚Äì20 km/h</option>
                  <option>20‚Äì60 km/h</option>
                  <option>60+ km/h</option>
                  <option>Any speed</option>
                </select>
              </div>
            </div>

            <div class="grid sm:grid-cols-2 gap-6 mb-6">
              <div>
                <label class="block mb-2 font-semibold">Pitch</label>
                <input id="pitch" name="pitch" type="range" min="1" max="5" value="3" class="w-full">
                <div class="flex justify-between text-xs text-gray-500 mt-1"><span>Low</span><span>High</span></div>
              </div>
              <div>
                <label class="block mb-2 font-semibold">Severity (1‚Äì5)</label>
                <input id="severity" name="severity" type="range" min="1" max="5" value="3" class="w-full">
                <div class="flex justify-between text-xs text-gray-500 mt-1"><span>Low</span><span>High</span></div>
              </div>
            </div>

            <!-- Advanced details -->
            <details class="mb-6">
              <summary class="cursor-pointer text-blue-700 font-semibold text-lg">‚ñ∂ Advanced details (optional)</summary>
              <div class="mt-4 space-y-5 text-sm">
                <div>
                  <p class="font-semibold mb-2">Weather / road conditions</p>
                  <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                    <label class="flex items-center gap-2"><input type="checkbox" name="weather" value="Rain"> Rain</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="weather" value="Snow"> Snow</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="weather" value="Very cold"> Very cold</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="weather" value="Hot day"> Hot day</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="weather" value="Gravel / rough roads"> Gravel / rough roads</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="weather" value="After car wash"> After car wash</label>
                  </div>
                </div>

                <div>
                  <p class="font-semibold mb-2">Vehicle mods</p>
                  <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                    <label class="flex items-center gap-2"><input type="checkbox" name="mods" value="Aftermarket intake/exhaust"> Aftermarket intake/exhaust</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="mods" value="Lift or lowering kit"> Lift or lowering kit</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="mods" value="Larger wheels/tires"> Larger wheels/tires</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="mods" value="Performance tune"> Performance tune</label>
                  </div>
                </div>

                <div>
                  <p class="font-semibold mb-2">Recent work</p>
                  <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                    <label class="flex items-center gap-2"><input type="checkbox" name="recentWork" value="Brake service"> Brake service</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="recentWork" value="Suspension work"> Suspension work</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="recentWork" value="Tire change/alignment"> Tire change/alignment</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="recentWork" value="Oil change"> Oil change</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="recentWork" value="Transmission work"> Transmission work</label>
                  </div>
                </div>

                <div>
                  <p class="font-semibold mb-2">Dashboard lights</p>
                  <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                    <label class="flex items-center gap-2"><input type="checkbox" name="dashLights" value="Check Engine"> Check Engine</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="dashLights" value="ABS"> ABS</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="dashLights" value="Brake"> Brake</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="dashLights" value="Battery/Charging"> Battery/Charging</label>
                    <label class="flex items-center gap-2"><input type="checkbox" name="dashLights" value="Power Steering"> Power Steering</label>
                  </div>
                </div>
              </div>
            </details>

            <!-- Vehicle / Notes -->
            <div class="mb-6">
              <label for="makeModel" class="block mb-2 font-semibold">Vehicle make and model:</label>
              <input
                type="text"
                id="makeModel"
                name="makeModel"
                class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400"
                placeholder="e.g. Toyota Corolla 2016"
              />
            </div>

            <div class="mb-1">
              <label for="notes" class="block mb-2 font-semibold">Any other notes?</label>
              <textarea
                id="notes"
                name="notes"
                class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none"
                placeholder="Optional..."
              ></textarea>
            </div>
          </div>

          <!-- Draft status + clear -->
          <div class="break-inside-avoid mt-6">
            <div class="flex items-center justify-between">
              <p id="draftStatus" class="text-sm text-gray-500">Drafts auto-save locally as you type.</p>
              <button type="button" id="clearDraftBtn" class="text-sm text-blue-600 hover:underline">Clear draft</button>
            </div>
          </div>

          <!-- Submit -->
          <div class="break-inside-avoid flex justify-center mt-6">
            <button
              type="submit"
              class="bg-blue-600 bg-opacity-80 backdrop-blur-md text-white font-semibold px-10 py-4 rounded-full shadow-lg hover:bg-blue-700 hover:bg-opacity-100 hover:scale-105 transform transition duration-300 ease-in-out ring-1 ring-blue-300"
            >
              Diagnose
            </button>
          </div>

        </div>
      </section>
      <!-- /Step Section -->
    </form>
  </div>
</section>
<!-- /Diagnostic Section -->

<!-- Loading overlay -->
<div id="loading"
     class="hidden fixed inset-0 z-[70] flex items-center justify-center p-6 bg-black/40 backdrop-blur-sm"
     role="dialog" aria-modal="true" aria-labelledby="loadingTitle" aria-describedby="loadingMain">
  <div class="w-full max-w-md bg-white rounded-2xl shadow-2xl p-6 text-gray-800" tabindex="-1">
    <div class="flex items-center gap-3 mb-2">
      <div class="animate-spin rounded-full h-6 w-6 border-4 border-blue-600 border-t-transparent" aria-hidden="true"></div>
      <p id="loadingTitle" class="font-semibold text-blue-700">Analyzing your report‚Ä¶</p>
    </div>
    <p id="loadingMain" class="text-sm text-gray-700 mb-3">
      This may take 30‚Äì60 seconds depending on your connection and audio length.
    </p>
    <ul class="text-sm list-disc ml-5 space-y-1">
      <li>Uploading your audio (if provided)</li>
      <li>Transcribing the sound to text</li>
      <li>Running AI analysis on patterns & operating conditions</li>
      <li>Matching tutorials and possible parts</li>
    </ul>
    <div class="mt-4 text-xs text-gray-500 flex items-center gap-2" role="status" aria-live="polite">
      <span class="inline-flex h-1.5 w-1.5 rounded-full bg-blue-500"></span>
      <span id="loadingRotating">Preparing analysis‚Ä¶</span>
    </div>
  </div>
</div>

<!-- AI Diagnosis + PDF button -->
<div id="diagnosisResult" class="mt-10 hidden">
  <div class="bg-white border border-gray-300 rounded-xl shadow-lg p-6 space-y-4 max-w-3xl mx-auto">
    <h2 class="text-2xl font-semibold flex items-center gap-2">üß† AI Diagnosis</h2>
    <p id="diagnosisTimestamp" class="text-sm text-gray-500 flex items-center gap-2">
      ‚è±Ô∏è <span id="timestampText">Now</span>
    </p>
    <div id="diagnosisContent" class="text-gray-800 leading-relaxed whitespace-pre-wrap"></div>
    <div id="diagnosisSuggestions" class="mt-4"></div>
    <div class="flex justify-end">
      <button id="downloadPdfBtn" class="px-4 py-2 text-sm bg-gray-800 text-white rounded hover:bg-black">
        ‚¨áÔ∏è Download PDF report
      </button>
    </div>
  </div>
</div>

<!-- Diagnosis History -->
<div class="mt-10 max-w-3xl mx-auto" id="history">
  <details class="bg-white shadow-md rounded-lg p-4">
    <summary class="cursor-pointer text-blue-700 font-semibold text-lg hover:underline">
      View past diagnoses
    </summary>
    <div class="flex justify-end mb-2">
      <button id="clearHistoryButton" class="text-red-600 hover:underline text-sm">üóëÔ∏è Clear History</button>
    </div>
    <div id="historyList" class="mt-4 text-sm text-gray-800 space-y-4"></div>
  </details>
</div>

<!-- About Section -->
<section id="about" class="bg-white py-12 border-t border-gray-200 mt-24">
  <div class="max-w-4xl mx-auto px-4 text-center">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">About MyAutoSound</h2>
    <p class="text-gray-600 leading-relaxed">
      MyAutoSound is a diagnostic assistant created to help car owners better understand strange vehicle sounds.
      Whether it's a squeak, knock, or rattle, our goal is to guide users toward possible causes and solutions.
    </p>
    <p class="text-gray-600 mt-4 leading-relaxed">
      This project was built with passion for automotive problem-solving and modern web technology. Our mission is to make car diagnostics more accessible and intuitive for everyone.
    </p>
  </div>
</section>

<!-- Garages Near Me Section -->
<section id="findGarages" class="py-20 bg-white border-t border-gray-200">
  <div class="max-w-5xl mx-auto px-4 text-center">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Discover top-rated auto repair shops nearby</h2>
    <p class="text-gray-600 mb-6">Use your location to find trusted mechanics around you.</p>

    <button
      id="findGaragesBtn"
      class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg shadow-md transition"
    >
      üîç Find garages near me
    </button>

    <div id="map" class="mt-8 w-full h-[500px] rounded-lg shadow-md"></div>
    <div id="garageList" class="mt-10 text-left space-y-4 max-w-3xl mx-auto"></div>
  </div>
</section>

<!-- Feedback / Satisfaction -->
<section id="feedback" class="max-w-3xl mx-auto px-4 py-12">
  <div class="bg-white rounded-2xl shadow p-6">
    <h2 class="text-xl font-bold text-gray-900">Your feedback helps üôå</h2>
    <p class="text-gray-600 mt-1 text-sm">
      Was the site helpful? Tell us what we should improve.
    </p>

    <!-- Helpful? -->
    <div class="mt-5">
      <label class="block text-sm font-semibold text-gray-800 mb-2">Was the site helpful?</label>
      <div id="fbUsefulGroup" class="flex flex-wrap gap-2">
        <button type="button" data-useful="yes"
                class="fb-chip px-3 py-1.5 rounded-md border border-gray-300 text-sm hover:bg-green-50">
          üëç Yes, helpful
        </button>
        <button type="button" data-useful="no"
                class="fb-chip px-3 py-1.5 rounded-md border border-gray-300 text-sm hover:bg-red-50">
          üëé Not really
        </button>
      </div>
    </div>

    <!-- Category -->
    <div class="mt-5">
      <label for="fbCategory" class="block text-sm font-semibold text-gray-800 mb-2">What should we improve?</label>
      <select id="fbCategory" class="w-full p-2 rounded-md border border-gray-300 text-sm">
        <option value="">‚Äî Select ‚Äî</option>
        <option value="accuracy">Diagnosis accuracy</option>
        <option value="speed">Analysis speed</option>
        <option value="ui">Interface / clarity</option>
        <option value="tutorials">Tutorials / content</option>
        <option value="other">Other</option>
      </select>
    </div>

    <!-- Message -->
    <div class="mt-5">
      <label for="fbMessage" class="block text-sm font-semibold text-gray-800 mb-2">
        Describe your idea for improvement
      </label>
      <textarea id="fbMessage" rows="4"
                class="w-full p-3 rounded-md border border-gray-300 text-sm"
                placeholder="e.g., Mobile form is too long; the 'clunk' sound wasn‚Äôt recognized; please add more brake tutorials‚Ä¶"></textarea>
      <div class="mt-1 text-xs text-gray-500"><span id="fbCount">0</span>/800 characters</div>
      <!-- Honeypot anti-spam -->
      <input type="text" id="fbHP" autocomplete="off" tabindex="-1" style="position:absolute;left:-9999px;opacity:0" />
    </div>

    <!-- Optional contact -->
    <div class="mt-5 grid grid-cols-1 md:grid-cols-2 gap-3 items-start">
      <div>
        <label for="fbEmail" class="block text-sm font-semibold text-gray-800 mb-1">Email (optional)</label>
        <input id="fbEmail" type="email" inputmode="email" autocomplete="email"
               class="w-full p-2 rounded-md border border-gray-300 text-sm"
               placeholder="If you‚Äôd like a reply‚Ä¶">
      </div>
      <label class="inline-flex items-start gap-2 text-sm text-gray-700 mt-6 md:mt-0">
        <input id="fbConsent" type="checkbox" class="mt-0.5">
        <span>You may contact me about this feedback.</span>
      </label>
    </div>

    <!-- Actions -->
    <div class="mt-6 flex flex-wrap gap-3">
      <button id="fbSubmit"
              class="px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-semibold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">
        Send feedback
      </button>
      <button id="fbCopy"
              class="px-4 py-2 rounded-lg bg-gray-100 text-gray-800 text-sm border hover:bg-gray-200">
        Copy feedback (JSON)
      </button>
      <span id="fbStatus" class="text-sm text-gray-500"></span>
    </div>

    <!-- Thanks -->
    <div id="fbThanks" class="hidden mt-6 p-3 rounded-md bg-green-50 border border-green-200 text-green-800 text-sm">
      Thanks for your feedback! üíô
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="bg-gray-100 text-gray-600 text-sm py-6 mt-20 border-t">
  <div class="max-w-4xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
    <p>&copy; 2025 MyAutoSound. All rights reserved.</p>
    <div class="mt-2 md:mt-0">
      <a href="mailto:contact@myautosound.com" class="hover:underline hover:text-blue-600">
        ‚úâÔ∏è Contact us: contact@myautosound.com
      </a>
    </div>
  </div>
</footer>

<!-- ‚úÖ API GOOGLE MAPS -->
<script>
  let map;
  async function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 45.5017, lng: -73.5673 },
      zoom: 13,
    });
  }
  function calculateDistance(origin, destination) {
    const R = 6371e3;
    const œÜ1 = origin.lat * Math.PI/180;
    const œÜ2 = destination.lat() * Math.PI/180;
    const ŒîœÜ = (destination.lat() - origin.lat) * Math.PI/180;
    const ŒîŒª = (destination.lng() - origin.lng) * Math.PI/180;
    const a = Math.sin(ŒîœÜ/2)**2 + Math.cos(œÜ1)*Math.cos(œÜ2)*Math.sin(ŒîŒª/2)**2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c / 1000;
  }
  document.getElementById("findGaragesBtn").addEventListener("click", async () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((position) => {
        const userLocation = { lat: position.coords.latitude, lng: position.coords.longitude };
        map.setCenter(userLocation);
        const service = new google.maps.places.PlacesService(map);
        const request = { location: userLocation, radius: 10000, type: "car_repair", keyword: "garage" };
        service.nearbySearch(request, (results, status) => {
          const garageList = document.getElementById("garageList");
          garageList.innerHTML = "";
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            const prioritized = results
              .map((place) => {
                const distance = calculateDistance(userLocation, place.geometry.location);
                const name = place.name.toLowerCase();
                const hasGarageKeyword = name.includes("garage") || name.includes("atelier");
                return { ...place, distance, hasGarageKeyword };
              })
              .sort((a, b) => (a.hasGarageKeyword !== b.hasGarageKeyword) ? (b.hasGarageKeyword - a.hasGarageKeyword) : (a.distance - b.distance));

            prioritized.forEach((place) => {
              new google.maps.Marker({ position: place.geometry.location, map, title: place.name });
              const name = place.name;
              const address = place.vicinity || "Address not available";
              const rating = place.rating ? `‚≠ê ${place.rating}/5` : "No rating";
              const distance = place.distance.toFixed(1);
              const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(name + " " + address)}`;
              const div = document.createElement("div");
              div.className = "p-4 bg-gray-100 rounded-lg shadow space-y-1";
              div.innerHTML = `
                <h3 class="text-lg font-semibold text-blue-700">${name}</h3>
                <p class="text-sm text-gray-700">${address}</p>
                <p class="text-sm text-gray-700">${rating}</p>
                <p class="text-sm text-gray-600">üìç ${distance} km away</p>
                <a href="${mapLink}" target="_blank" class="text-blue-600 text-sm hover:underline">Open in Google Maps</a>
              `;
              garageList.appendChild(div);
            });
            if (!prioritized.length) {
              garageList.innerHTML = `<p class="text-gray-600 text-center">No open garages found near you.</p>`;
            }
          } else {
            console.error("PlacesService failed:", status);
            alert("An error occurred while fetching nearby garages.");
          }
        });
      }, () => { alert("Unable to retrieve your location. Please allow location access."); });
    } else { alert("Geolocation not supported by this browser."); }
  });
</script>

<!-- üîë Google Maps SDK -->
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBHoVFe6mCVVMCxIG6xcccjLCO4ELPvftU&libraries=places&callback=initMap"
  async defer></script>

<!-- üõ°Ô∏è Consent Banner -->
<div id="consent-banner" class="fixed bottom-0 inset-x-0 bg-white border-t border-gray-300 p-4 shadow-lg z-50">
  <div class="max-w-4xl mx-auto flex flex-col md:flex-row justify-between items-center text-sm text-gray-800">
    <p class="mb-2 md:mb-0">We use cookies and Google Analytics to improve your experience. By clicking ‚ÄúAccept‚Äù, you agree to this use.</p>
    <div class="flex space-x-3">
      <button id="acceptCookies" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Accept</button>
      <button id="declineCookies" class="text-blue-600 hover:underline">Decline</button>
    </div>
  </div>
</div>
<script>
  const hasConsent = localStorage.getItem("cookieConsent");
  if (hasConsent === "accepted") { loadAnalytics(); }
  else if (hasConsent === "declined") { document.getElementById("consent-banner").style.display = "none"; }
  document.getElementById("acceptCookies").addEventListener("click", () => {
    localStorage.setItem("cookieConsent", "accepted");
    document.getElementById("consent-banner").style.display = "none";
    loadAnalytics();
  });
  document.getElementById("declineCookies").addEventListener("click", () => {
    localStorage.setItem("cookieConsent", "declined");
    document.getElementById("consent-banner").style.display = "none";
  });
  function loadAnalytics() {
    const script1 = document.createElement('script');
    script1.async = true;
    script1.src = 'https://www.googletagmanager.com/gtag/js?id=G-1FL8JMYNX0';
    document.head.appendChild(script1);
    const script2 = document.createElement('script');
    script2.innerHTML = `
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-1FL8JMYNX0');
    `;
    document.head.appendChild(script2);
  }
</script>

<!-- Beta toast message -->
<div id="betaToast" class="fixed bottom-4 right-4 bg-yellow-200 text-yellow-900 p-4 rounded-xl shadow-xl text-sm max-w-xs z-50 border border-yellow-400">
  <div class="font-semibold mb-1">üöß Beta Notice</div>
  This site is currently in <strong>beta</strong>. Some features may be incomplete or unstable.
</div>
<script>
  setTimeout(() => { const toast = document.getElementById('betaToast'); if (toast) toast.remove(); }, 6000);
</script>

<!-- üß† Auto-save draft v2 + payload builder (doit √™tre AVANT script.js) -->
<script>
(() => {
  const DRAFT_KEY = "mas_draft_v2";
  const form = document.getElementById("diagnosisForm");
  if (!form) return;

  const $ = (id) => document.getElementById(id);
  const getChecks = (name) => [...form.querySelectorAll(`input[name="${name}"]:checked`)].map(el => el.value);
  const setChecks = (name, values=[]) => {
    const set = new Set(values || []);
    form.querySelectorAll(`input[name="${name}"]`).forEach(el => el.checked = set.has(el.value));
  };

  const fields = {
    textInput: $("textInput"),
    location: $("location"),
    situation: $("situation"),
    rhythm: $("rhythm"),
    duration: $("duration"),
    pitch: $("pitch"),
    speedRange: $("speedRange"),
    severity: $("severity"),
    mileage: $("mileage"),
    transmission: $("transmission"),
    fuel: $("fuel"),
    obdCode: $("obdCode"),
    reproducible: $("reproducible"),
    makeModel: $("makeModel"),
    notes: $("notes"),
  };

  const statusEl = $("draftStatus");
  const setStatus = (msg) => { if (statusEl) statusEl.textContent = msg; };

  function loadDraft() {
    try {
      const raw = localStorage.getItem(DRAFT_KEY);
      if (!raw) return;
      const d = JSON.parse(raw);
      Object.entries(fields).forEach(([k, el]) => { if (el && d[k] != null) el.value = d[k]; });
      setChecks("when", d.when);
      setChecks("soundType", d.soundType);
      setChecks("warning", d.warning);
      setChecks("recent", d.recent);
      setStatus("Draft restored.");
    } catch {}
  }

  let saveTimer;
  function scheduleSave(){ clearTimeout(saveTimer); saveTimer = setTimeout(saveDraft, 400); }
  function saveDraft() {
    try {
      const data = {
        description: fields.textInput?.value || "",
        location: fields.location?.value || "",
        situation: fields.situation?.value || "",
        when: getChecks("when"),
        soundType: getChecks("soundType"),
        rhythm: fields.rhythm?.value || "",
        duration: fields.duration?.value || "",
        pitch: fields.pitch?.value || "",
        speedRange: fields.speedRange?.value || "",
        severity: fields.severity?.value || "",
        mileage: fields.mileage?.value || "",
        transmission: fields.transmission?.value || "",
        fuel: fields.fuel?.value || "",
        warning: getChecks("warning"),
        recent: getChecks("recent"),
        obdCode: fields.obdCode?.value || "",
        reproducible: fields.reproducible?.value || "",
        makeModel: fields.makeModel?.value || "",
        notes: fields.notes?.value || "",
        ts: Date.now(),
      };
      localStorage.setItem(DRAFT_KEY, JSON.stringify(data));
      setStatus("Draft saved.");
    } catch {}
  }
  function clearDraft() {
    try { localStorage.removeItem(DRAFT_KEY); } catch {}
    form.reset();
    ["when","soundType","warning","recent"].forEach(name => {
      form.querySelectorAll(`input[name="${name}"]`).forEach(el => el.checked = false);
    });
    setStatus("Draft cleared.");
  }

  Object.values(fields).forEach(el => { if (!el) return; el.addEventListener("input", scheduleSave); el.addEventListener("change", scheduleSave); });
  ["when","soundType","warning","recent"].forEach(name => {
    form.querySelectorAll(`input[name="${name}"]`).forEach(el => el.addEventListener("change", scheduleSave));
  });

  document.getElementById("clearDraftBtn")?.addEventListener("click", clearDraft);
  form.addEventListener("submit", () => { try { localStorage.removeItem(DRAFT_KEY); } catch {} });

  // Export global: payload structur√©
  window.buildDiagnosisPayload = function buildDiagnosisPayload() {
    const audioAttached = !!document.getElementById("audioFile")?.files?.length || !!document.getElementById("recordedAudio")?.recordedBlob;
    return {
      description: fields.textInput?.value?.trim() || "",
      audioAttached,
      location: fields.location?.value || null,
      primarySituation: fields.situation?.value || null,
      situations: [...form.querySelectorAll('input[name="when"]:checked')].map(el => el.value),
      soundProfile: {
        labels: [...form.querySelectorAll('input[name="soundType"]:checked')].map(el => el.value),
        rhythm: fields.rhythm?.value || null,
        duration: fields.duration?.value || null,
        pitchLevel: Number(fields.pitch?.value || 0),
        severityLevel: Number(fields.severity?.value || 0),
      },
      driving: {
        speedRange: fields.speedRange?.value || null,
        reproducible: fields.reproducible?.value || null,
      },
      vehicle: {
        makeModel: fields.makeModel?.value?.trim() || null,
        mileage: fields.mileage?.value ? Number(fields.mileage.value) : null,
        transmission: fields.transmission?.value || null,
        fuel: fields.fuel?.value || null,
        obdCode: fields.obdCode?.value?.trim() || null,
        warningLights: [...form.querySelectorAll('input[name="warning"]:checked')].map(el => el.value),
      },
      recentEvents: [...form.querySelectorAll('input[name="recent"]:checked')].map(el => el.value),
      notes: fields.notes?.value?.trim() || "",
      timestamp: new Date().toISOString(),
    };
  };

  loadDraft();
})();
</script>

<!-- jsPDF (pour export PDF) -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" defer></script>

<!-- Ton script principal (diagnostic) -->
<script src="script.js"></script>

<!-- ===== EmailJS (Option C) : remplace PUBLIC_KEY / YOUR_SERVICE_ID / YOUR_TEMPLATE_ID ===== -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
(function(){
  // 1) Initialise EmailJS
  emailjs.init("eKA64aazIN1Z0h7_d"); // ‚Üê remplace par ta Public Key

  const chips = document.querySelectorAll("#fbUsefulGroup .fb-chip");
  let useful = null;
  chips.forEach(b => b.addEventListener("click", () => {
    useful = b.dataset.useful;
    chips.forEach(c => c.classList.toggle("ring-2", c === b));
  }));

  const $ = (id) => document.getElementById(id);
  const msg = $("fbMessage"), cat = $("fbCategory"), email = $("fbEmail"),
        consent = $("fbConsent"), submit = $("fbSubmit"), copyBtn = $("fbCopy"),
        status = $("fbStatus"), thanks = $("fbThanks"), cnt = $("fbCount"),
        hp = $("fbHP");

  // Compteur caract√®res
  msg.addEventListener("input", () => {
    if (msg.value.length > 800) msg.value = msg.value.slice(0,800);
    cnt.textContent = msg.value.length;
  });

  // Envoi via EmailJS
  submit.addEventListener("click", async () => {
    status.textContent = ""; thanks.classList.add("hidden");

    // Honeypot anti-spam : si rempli, on bloque
    if (hp && hp.value) { status.textContent = "Bot detected."; return; }

    const params = {
      useful: useful || "‚Äî",
      category: cat.value || "general",
      message: msg.value.trim(),
      reply_to: (email.value || "").trim(), // utilis√© par EmailJS si le template contient {{reply_to}}
      consent: consent.checked ? "yes" : "no",
      // optionnel : ajoute d‚Äôautres champs de template si besoin
    };

    if (!params.message || params.message.length < 5) {
      status.textContent = "Please describe your idea (min. 5 characters).";
      return;
    }

    submit.disabled = true; submit.textContent = "Sending‚Ä¶";
    try {
      await emailjs.send("service_sen3w1i", "template_4zk9qjh", params); // ‚Üê remplace
      thanks.classList.remove("hidden");
      status.textContent = "Sent!";

      // Reset l√©ger
      msg.value = ""; cnt.textContent = "0";
      email.value = ""; consent.checked = false; cat.value = "";
      useful = null; chips.forEach(c => c.classList.remove("ring-2"));
    } catch (e) {
      console.error(e);
      status.textContent = "Sending failed. Try again later.";
    } finally {
      submit.disabled = false; submit.textContent = "Send feedback";
    }
  });

  // Copie JSON local (utile si envoi √©choue)
  copyBtn.addEventListener("click", async () => {
    const payload = {
      useful: useful || "‚Äî",
      category: cat.value || "general",
      message: msg.value.trim(),
      email: (email.value || "").trim(),
      consent: consent.checked,
      ts: new Date().toISOString()
    };
    try {
      await navigator.clipboard.writeText(JSON.stringify(payload, null, 2));
      status.textContent = "Copied to clipboard.";
      setTimeout(() => status.textContent = "", 2000);
    } catch {
      status.textContent = "Copy failed.";
    }
  });
})();
</script>

</body>
</html>
