<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MyAutoSound Tutorials</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Poppins', sans-serif; }
    /* Lite YouTube embed */
    .yt-lite {
      position: relative; cursor: pointer; border-radius: 0.75rem;
      overflow: hidden; display: block; background-size: cover;
      background-position: center; min-height: 180px;
    }
    .yt-lite::after {
      content: "‚ñ∂";
      position: absolute; inset: 0; display: grid; place-items: center;
      font-size: 48px; background: rgba(0,0,0,.35); color: #fff;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen">

  <!-- Header -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-xl font-bold text-blue-700">MyAutoSound Tutorials</h1>
      <a href="index.html" class="text-sm text-blue-600 hover:underline">‚Üê Back to Home</a>
    </div>
  </header>

  <!-- Filters -->
  <section class="max-w-5xl mx-auto px-4 py-8">
    <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
      <input type="text" id="searchInput" placeholder="Search tutorials..." class="w-full md:w-1/3 p-3 rounded border border-gray-300" />

      <select id="categoryFilter" class="w-full md:w-1/3 p-3 rounded border border-gray-300">
        <option value="">All Categories</option>
        <option value="brake">Brake</option>
        <option value="engine">Engine</option>
        <option value="suspension">Suspension</option>
        <option value="steering">Steering</option>
        <option value="transmission">Transmission</option>
        <option value="exhaust">Exhaust</option>
        <option value="vacuum">Vacuum</option>
        <option value="drivetrain">Drivetrain</option>
      </select>

      <select id="typeFilter" class="w-full md:w-1/3 p-3 rounded border border-gray-300">
        <option value="">All Types</option>
        <option value="video">Video</option>
        <option value="audio">Audio</option>
        <option value="pdf">PDF</option>
      </select>
    </div>

    <!-- üé• Video Tutorials -->
    <h2 class="text-2xl font-bold text-blue-800 mt-12 mb-6">üé• Video Tutorials</h2>

    <!-- üîß Fix it at home -->
    <h3 class="text-xl font-bold text-blue-700 mt-8 mb-4">üîß Fix it at home</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="videoFix"></div>

    <!-- üëÇ Inspect your car noise -->
    <h3 class="text-xl font-bold text-blue-700 mt-8 mb-4">üëÇ Inspect your car noise</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="videoInspect"></div>

    <!-- üßº Car maintenance you should do at home -->
    <h3 class="text-xl font-bold text-blue-700 mt-8 mb-4">üßº Car maintenance you should do at home</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="videoMaintenance"></div>

    <!-- üîâ Audio Examples -->
    <h2 class="text-2xl font-bold text-blue-800 mt-12 mb-6">üîâ Sound Examples</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="audioSection"></div>

    <!-- üìÑ PDF Guides -->
    <h2 class="text-2xl font-bold text-blue-800 mt-12 mb-6">üìÑ PDF Guides</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="pdfSection"></div>

    <!-- Status / errors -->
    <div id="statusMsg" class="mt-8 text-center text-sm text-gray-500"></div>
  </section>

  <!-- Footer -->
  <footer class="bg-white border-t border-gray-200 text-center text-sm text-gray-600 py-6 mt-10">
    &copy; 2025 MyAutoSound. All rights reserved.
  </footer>

  <!-- ================== Loader from tutorials.json with Lite YouTube Embed ================== -->
  <script>
  (async () => {
    const JSON_PATH = 'tutorials.json'; // ou 'data/tutorials.json' si tu le places dans /data

    // Containers
    const videoFix = document.getElementById('videoFix');
    const videoInspect = document.getElementById('videoInspect');
    const videoMaintenance = document.getElementById('videoMaintenance');
    const audioSection = document.getElementById('audioSection');
    const pdfSection = document.getElementById('pdfSection');
    const statusMsg = document.getElementById('statusMsg');

    // Filters
    const searchInput = document.getElementById('searchInput');
    const categoryFilter = document.getElementById('categoryFilter');
    const typeFilter = document.getElementById('typeFilter');

    // Cookie consent already handled on index.html; reuse localStorage flag here
    const hasConsent = localStorage.getItem("cookieConsent") === "accepted";

    // Helpers
    const fallbackThumb = 'assets/img/default-sound.jpg';
    const imgHTML = (src, alt) => {
      return `<img src="${src || fallbackThumb}" alt="${alt}" class="rounded-xl mb-4 w-full h-40 object-cover" loading="lazy" />`;
    };
    const ytThumb = (ytId) => `https://i.ytimg.com/vi/${ytId}/hqdefault.jpg`;

    // Create cards
    function createVideoCard(item) {
      const card = document.createElement('div');
      card.className = 'tutorial bg-white rounded-2xl shadow p-4 flex flex-col';
      card.dataset.type = 'video';
      card.dataset.category = item.category || '';
      card.dataset.vgroup = (item.vgroup || 'inspect').toLowerCase();

      const titleHTML = `<h2 class="text-lg font-bold text-blue-700 mb-1">${item.title}</h2>`;
      const descHTML = `<p class="text-sm text-gray-600 mb-3">${item.description || ''}</p>`;

      // If YouTube ID present => lite embed
      if (item.ytId) {
        const thumbUrl = item.thumb || ytThumb(item.ytId);
        // wrapper as clickable thumbnail (replaced by iframe on click if consent)
        const wrapper = document.createElement('div');
        wrapper.className = 'yt-lite mb-4';
        wrapper.style.backgroundImage = `url('${thumbUrl}')`;
        wrapper.setAttribute('aria-label', `Play ${item.title}`);
        wrapper.addEventListener('click', () => {
          if (!hasConsent) {
            // No consent -> open YouTube in new tab (privacy-friendly)
            window.open(`https://www.youtube.com/watch?v=${item.ytId}`, '_blank', 'noopener');
            return;
          }
          const iframe = document.createElement('iframe');
          iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
          iframe.src = `https://www.youtube-nocookie.com/embed/${item.ytId}?autoplay=1&rel=0`;
          iframe.loading = "lazy";
          iframe.title = item.title;
          iframe.width = "100%";
          iframe.height = "315";
          iframe.style.border = "0";
          wrapper.replaceWith(iframe);
        });

        // Build card
        const top = document.createElement('div');
        top.innerHTML = imgHTML(thumbUrl, item.title); // keeps layout stable if JS disabled
        // Replace static image with the lite wrapper
        top.firstElementChild.replaceWith(wrapper);

        const btnHTML = `
          <a href="https://www.youtube.com/watch?v=${item.ytId}" target="_blank" rel="noopener"
             class="bg-red-600 text-white px-4 py-2 rounded text-sm w-fit hover:bg-red-700 transition">‚ñ∂Ô∏è Watch on YouTube</a>`;

        card.innerHTML = `${titleHTML}${descHTML}`;
        card.prepend(top);
        card.insertAdjacentHTML('beforeend', btnHTML);
        return card;
      }

      // Else: MP4 or external video link fallback (no iframe for performance)
      const thumbUrl = item.thumb || fallbackThumb;
      const videoUrl = item.videoUrl || '#';
      const btnHTML = `
        <a href="${videoUrl}" target="_blank" rel="noopener"
           class="bg-blue-600 text-white px-4 py-2 rounded text-sm w-fit hover:bg-blue-700 transition">üé• Watch Video</a>`;
      card.innerHTML = `
        ${imgHTML(thumbUrl, item.title)}
        ${titleHTML}
        ${descHTML}
        ${btnHTML}
      `;
      return card;
    }

    function createAudioCard(item) {
      const card = document.createElement('div');
      card.className = 'tutorial bg-white rounded-2xl shadow p-4 flex flex-col';
      card.dataset.type = 'audio';
      card.dataset.category = item.category || '';
      card.innerHTML = `
        ${imgHTML(item.thumb, item.title)}
        <div class="flex-1">
          <h2 class="text-lg font-bold text-blue-700 mb-1">${item.title}</h2>
          <p class="text-sm text-gray-600 mb-3">${item.description || ''}</p>
          <audio controls class="w-full"><source src="${item.audioUrl}" type="audio/mpeg" /></audio>
        </div>
      `;
      return card;
    }

    function createPdfCard(item) {
      const card = document.createElement('div');
      card.className = 'tutorial bg-white rounded-2xl shadow p-4 flex flex-col';
      card.dataset.type = 'pdf';
      card.dataset.category = item.category || '';
      card.innerHTML = `
        ${imgHTML(item.thumb, item.title)}
        <div class="flex-1">
          <h2 class="text-lg font-bold text-blue-700 mb-1">${item.title}</h2>
          <p class="text-sm text-gray-600 mb-3">${item.description || ''}</p>
          <a href="${item.pdfUrl}" target="_blank"
             class="bg-gray-700 text-white px-4 py-2 rounded text-sm w-fit hover:bg-gray-800 transition">üìÑ View PDF</a>
        </div>
      `;
      return card;
    }

    // Fetch JSON
    try {
      statusMsg.textContent = 'Loading tutorials...';
      const res = await fetch(JSON_PATH, { cache: 'no-store' });
      if (!res.ok) throw new Error('Failed to load JSON');
      const items = await res.json();

      const allCards = [];

      items.forEach(item => {
        let card;
        if (item.type === 'video') {
          card = createVideoCard(item);
          const group = (item.vgroup || 'inspect').toLowerCase();
          const target = group === 'fix' ? videoFix
                       : group === 'maintenance' ? videoMaintenance
                       : videoInspect; // default
          target.appendChild(card);
        } else if (item.type === 'audio') {
          card = createAudioCard(item);
          audioSection.appendChild(card);
        } else if (item.type === 'pdf') {
          card = createPdfCard(item);
          pdfSection.appendChild(card);
        }
        if (card) allCards.push(card);
      });

      statusMsg.textContent = '';

      // Filters
      function filterTutorials() {
        const q = (searchInput?.value || '').toLowerCase();
        const cat = categoryFilter?.value || '';
        const typ = typeFilter?.value || '';

        allCards.forEach(card => {
          const title = (card.querySelector('h2')?.textContent || card.textContent).toLowerCase();
          const okSearch = !q || title.includes(q);
          const okCat = !cat || (card.dataset.category === cat);
          const okType = !typ || (card.dataset.type === typ);
          card.style.display = (okSearch && okCat && okType) ? 'block' : 'none';
        });
      }

      searchInput?.addEventListener('input', filterTutorials);
      categoryFilter?.addEventListener('change', filterTutorials);
      typeFilter?.addEventListener('change', filterTutorials);

    } catch (err) {
      console.error(err);
      statusMsg.className = 'mt-8 text-center text-sm text-red-600';
      statusMsg.textContent = 'Error loading tutorials. Make sure tutorials.json is accessible (serve over http://, not file://).';
    }
  })();
  </script>
</body>
</html>

