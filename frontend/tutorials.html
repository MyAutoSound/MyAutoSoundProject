<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MyAutoSound Tutorials</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Poppins comme sur la home -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Poppins', sans-serif; }

    /* La carte sert d‚Äôancre pour l‚Äô√©toile */
    .tutorial{ position: relative; }

    /* Lite YouTube embed */
    .yt-lite {
      position: relative; cursor: pointer; border-radius: 0.75rem;
      overflow: hidden; display: block; background-size: cover;
      background-position: center; min-height: 180px;
    }
    .yt-lite::after {
      content: "‚ñ∂";
      position: absolute; inset: 0; display: grid; place-items: center;
      font-size: 48px; background: rgba(0,0,0,.35); color: #fff;
    }

    /* Etoile de favoris ‚Äî tr√®s visible et au-dessus de l'image */
    .fav-btn{
      position:absolute;top:.5rem;right:.5rem;font-size:26px;line-height:1;
      color:#9ca3af;z-index:10;transition:transform .15s ease;
      background:rgba(255,255,255,.9);border-radius:.5rem;padding:.15rem .35rem
    }
    .fav-btn:hover{ transform:scale(1.1) }
    .fav-btn.is-fav{ color:#eab308 } /* dor√© quand favori */

    /* Cartes am√©lior√©es (hover/focus coh√©rents avec la home) */
    .card-ui { transition: transform .15s ease, box-shadow .15s ease; }
    .card-ui:hover { transform: translateY(-2px); box-shadow: 0 10px 24px rgba(0,0,0,.08); }
    .card-ui:focus-within { outline: none; box-shadow: 0 0 0 3px rgba(59,130,246,.35); }

    /* Aspect ratio 16/9 pour toutes les vignettes */
    .thumb { aspect-ratio: 16/9; width: 100%; object-fit: cover; border-radius: 0.75rem; }

    /* Skeletons */
    .skeleton-card { border-radius: 0.75rem; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen">

  <!-- Header -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-xl font-bold text-blue-700">MyAutoSound Tutorials</h1>
      <a href="index.html" class="text-sm text-blue-600 hover:underline focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300 rounded">‚Üê Back to Home</a>
    </div>
  </header>

  <!-- Filters -->
  <section class="max-w-5xl mx-auto px-4 py-8">
    <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
      <input type="text" id="searchInput" placeholder="Search tutorials..." class="w-full md:w-1/3 p-3 rounded border border-gray-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300" />

      <select id="categoryFilter" class="w-full md:w-1/3 p-3 rounded border border-gray-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300">
        <option value="">All Categories</option>
        <option value="brake">Brake</option>
        <option value="engine">Engine</option>
        <option value="suspension">Suspension</option>
        <option value="steering">Steering</option>
        <option value="transmission">Transmission</option>
        <option value="exhaust">Exhaust</option>
        <option value="vacuum">Vacuum</option>
        <option value="drivetrain">Drivetrain</option>
      </select>

      <select id="typeFilter" class="w-full md:w-1/3 p-3 rounded border border-gray-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300">
        <option value="">All Types</option>
        <option value="video">Video</option>
        <option value="audio">Audio</option>
        <option value="pdf">PDF</option>
      </select>
    </div>

    <!-- ‚≠ê Favorites -->
    <div id="favoritesWrap" class="mt-10">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-2xl font-bold text-yellow-700">‚≠ê Favorites <span id="favCount" class="text-sm text-gray-500 font-normal"></span></h2>
        <button id="clearFavs" class="text-sm text-red-600 hover:underline focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300 rounded">Clear all</button>
      </div>
      <p id="favEmpty" class="text-sm text-gray-500 mb-4">No favorites yet. Click ‚òÖ on any card.</p>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="favoritesSection"></div>
    </div>

    <!-- üé• Video Tutorials -->
    <h2 class="text-2xl font-bold text-blue-800 mt-12 mb-6">üé• Video Tutorials</h2>

    <!-- üîß Fix it at home -->
    <h3 class="text-xl font-bold text-blue-700 mt-8 mb-4">üîß Fix it at home</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="videoFix"></div>
    <div class="flex justify-center mt-4">
      <button id="more-vfix" class="px-4 py-2 text-sm rounded bg-gray-200 hover:bg-gray-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300">Load more</button>
    </div>

    <!-- üëÇ Inspect your car noise -->
    <h3 class="text-xl font-bold text-blue-700 mt-8 mb-4">üëÇ Inspect your car noise</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="videoInspect"></div>
    <div class="flex justify-center mt-4">
      <button id="more-vins" class="px-4 py-2 text-sm rounded bg-gray-200 hover:bg-gray-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300">Load more</button>
    </div>

    <!-- üßº Car maintenance you should do at home -->
    <h3 class="text-xl font-bold text-blue-700 mt-8 mb-4">üßº Car maintenance you should do at home</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="videoMaintenance"></div>
    <div class="flex justify-center mt-4">
      <button id="more-vmaint" class="px-4 py-2 text-sm rounded bg-gray-200 hover:bg-gray-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300">Load more</button>
    </div>

    <!-- üîâ Audio Examples -->
    <h2 class="text-2xl font-bold text-blue-800 mt-12 mb-6">üîâ Sound Examples</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="audioSection"></div>
    <div class="flex justify-center mt-4">
      <button id="more-audio" class="px-4 py-2 text-sm rounded bg-gray-200 hover:bg-gray-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300">Load more</button>
    </div>

    <!-- üìÑ PDF Guides -->
    <h2 class="text-2xl font-bold text-blue-800 mt-12 mb-6">üìÑ PDF Guides</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="pdfSection"></div>
    <div class="flex justify-center mt-4">
      <button id="more-pdf" class="px-4 py-2 text-sm rounded bg-gray-200 hover:bg-gray-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300">Load more</button>
    </div>

    <!-- Status / errors -->
    <div id="statusMsg" class="mt-8 text-center text-sm text-gray-500"></div>
  </section>

  <!-- Footer -->
  <footer class="bg-white border-t border-gray-200 text-center text-sm text-gray-600 py-6 mt-10">
    &copy; 2025 MyAutoSound. All rights reserved.
  </footer>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-5 left-1/2 -translate-x-1/2 z-50 hidden">
    <div id="toastBox" class="rounded-lg shadow-lg px-4 py-2 text-sm font-medium bg-gray-900 text-white"></div>
  </div>

  <!-- ================== Loader from tutorials.json + Lite YouTube + Load More + Favorites + Skeletons + Toast ================== -->
  <script>
  (async () => {
    const JSON_PATH = 'tutorials.json';   // ou 'data/tutorials.json'
    const STEP = 6;                       // pagination par section
    const FAV_KEY = 'mas_favs_v1';        // cl√© localStorage

    // Containers
    const containers = {
      vfix: document.getElementById('videoFix'),
      vins: document.getElementById('videoInspect'),
      vmaint: document.getElementById('videoMaintenance'),
      audio: document.getElementById('audioSection'),
      pdf: document.getElementById('pdfSection'),
      favs: document.getElementById('favoritesSection')
    };
    const moreBtns = {
      vfix: document.getElementById('more-vfix'),
      vins: document.getElementById('more-vins'),
      vmaint: document.getElementById('more-vmaint'),
      audio: document.getElementById('more-audio'),
      pdf: document.getElementById('more-pdf'),
    };
    const favWrap = document.getElementById('favoritesWrap');
    const favCount = document.getElementById('favCount');
    const favEmpty = document.getElementById('favEmpty');
    const clearFavsBtn = document.getElementById('clearFavs');
    const statusMsg = document.getElementById('statusMsg');

    // Filters
    const searchInput = document.getElementById('searchInput');
    const categoryFilter = document.getElementById('categoryFilter');
    const typeFilter = document.getElementById('typeFilter');

    // Consent
    const hasConsent = localStorage.getItem("cookieConsent") === "accepted";

    // Helpers
    const fallbackThumb = 'assets/img/default-sound.jpg';
    const imgHTML = (src, alt) => `<img src="${src || fallbackThumb}" alt="${alt}" class="thumb mb-4" loading="lazy" />`;
    const ytThumb = (ytId) => `https://i.ytimg.com/vi/${ytId}/hqdefault.jpg`;

    // Toast
    let toastTimer;
    function showToast(text, variant='default') {
      const wrap = document.getElementById('toast');
      const box = document.getElementById('toastBox');
      clearTimeout(toastTimer);
      box.textContent = text;
      box.className = 'rounded-lg shadow-lg px-4 py-2 text-sm font-medium ' +
        (variant === 'ok' ? 'bg-green-600 text-white' :
         variant === 'warn' ? 'bg-yellow-500 text-black' :
         variant === 'err' ? 'bg-red-600 text-white' :
         'bg-gray-900 text-white');
      wrap.classList.remove('hidden', 'opacity-0');
      wrap.classList.add('opacity-100');
      toastTimer = setTimeout(() => {
        wrap.classList.add('opacity-0');
        setTimeout(()=>wrap.classList.add('hidden'), 200);
      }, 1600);
    }

    // Favorites storage
    const loadFavs = () => { try { return new Set(JSON.parse(localStorage.getItem(FAV_KEY) || '[]')); } catch { return new Set(); } };
    const saveFavs = (set) => { try { localStorage.setItem(FAV_KEY, JSON.stringify([...set])); } catch {} };
    let FAVS = loadFavs();

    // Skeletons
    const skeletonKeep = [];
    function addSkeletons(container, count=3) {
      for (let i=0;i<count;i++){
        const sk = document.createElement('div');
        sk.className = 'skeleton-card bg-white p-4 rounded-2xl shadow animate-pulse';
        sk.innerHTML = `
          <div class="rounded-xl bg-gray-200 mb-4 w-full" style="aspect-ratio:16/9;"></div>
          <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
          <div class="h-3 bg-gray-200 rounded w-1/2 mb-4"></div>
          <div class="h-8 bg-gray-200 rounded w-32"></div>
        `;
        container.appendChild(sk);
        skeletonKeep.push(sk);
      }
    }
    function clearSkeletons(){ skeletonKeep.forEach(el => el.remove()); skeletonKeep.length = 0; }

    // Items data
    let items = [];
    const itemsById = new Map();

    // UI: √©toile maj (centralis√©)
    function updateStarUI(id) {
      const active = FAVS.has(id);
      document.querySelectorAll(`.tutorial[data-id="${id}"] .fav-btn`).forEach(btn => {
        btn.textContent = active ? '‚òÖ' : '‚òÜ';
        btn.classList.toggle('is-fav', active);
        btn.setAttribute('aria-pressed', String(active));
        btn.title = active ? 'Remove from favorites' : 'Add to favorites';
        btn.setAttribute('aria-label', btn.title);
      });
      updateFavHeader();
    }

    function toggleFav(id) {
      const added = !FAVS.has(id);
      if (added) FAVS.add(id); else FAVS.delete(id);
      saveFavs(FAVS);
      updateStarUI(id);
      renderFavorites();
      showToast(added ? 'Added to favorites' : 'Removed from favorites', added ? 'ok' : 'warn');
    }

    function attachFavButton(card, item) {
      const btn = document.createElement('button');
      btn.className = 'fav-btn';
      btn.type = 'button';
      const isFav = FAVS.has(item.id);
      btn.textContent = isFav ? '‚òÖ' : '‚òÜ';
      if (isFav) btn.classList.add('is-fav');
      btn.setAttribute('aria-pressed', String(isFav));
      btn.title = isFav ? 'Remove from favorites' : 'Add to favorites';
      btn.setAttribute('aria-label', btn.title);
      btn.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); toggleFav(item.id); });
      card.appendChild(btn);
      updateStarUI(item.id);
    }

    // Build cards (cartes ‚Äúcard-ui‚Äù + vignettes 16/9)
    function createVideoCard(item) {
      const card = document.createElement('div');
      card.className = 'tutorial card-ui bg-white rounded-2xl shadow p-4 flex flex-col';
      card.tabIndex = 0;
      card.dataset.id = item.id;
      card.dataset.type = 'video';
      card.dataset.category = item.category || '';
      card.dataset.vgroup = (item.vgroup || 'inspect').toLowerCase();
      card.dataset.section = (item.vgroup === 'fix') ? 'vfix' : (item.vgroup === 'maintenance') ? 'vmaint' : 'vins';
      card._title = item.title.toLowerCase();

      const titleHTML = `<h2 class="text-lg font-bold text-blue-700 mb-1">${item.title}</h2>`;
      const descHTML = `<p class="text-sm text-gray-600 mb-3">${item.description || ''}</p>`;

      if (item.ytId) {
        const thumbUrl = item.thumb || ytThumb(item.ytId);
        const wrapper = document.createElement('div');
        wrapper.className = 'yt-lite mb-4';
        wrapper.style.backgroundImage = `url('${thumbUrl}')`;
        wrapper.setAttribute('aria-label', `Play ${item.title}`);
        wrapper.addEventListener('click', () => {
          if (!hasConsent) { window.open(`https://www.youtube.com/watch?v=${item.ytId}`, '_blank', 'noopener'); return; }
          const iframe = document.createElement('iframe');
          iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
          iframe.src = `https://www.youtube-nocookie.com/embed/${item.ytId}?autoplay=1&rel=0`;
          iframe.loading = "lazy";
          iframe.title = item.title;
          iframe.width = "100%";
          iframe.height = "315";
          iframe.style.border = "0";
          wrapper.replaceWith(iframe);
        });

        const top = document.createElement('div');
        top.innerHTML = imgHTML(thumbUrl, item.title);
        top.firstElementChild.replaceWith(wrapper);

        const btnHTML = `
          <a href="https://www.youtube.com/watch?v=${item.ytId}" target="_blank" rel="noopener"
             class="inline-flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded text-sm w-fit hover:bg-red-700 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-300">‚ñ∂Ô∏è Watch on YouTube</a>`;

        const inner = document.createElement('div');
        inner.innerHTML = `${titleHTML}${descHTML}`;
        card.appendChild(top);
        card.appendChild(inner);
        card.insertAdjacentHTML('beforeend', btnHTML);
      } else {
        const thumbUrl = item.thumb || fallbackThumb;
        const videoUrl = item.videoUrl || '#';
        const btnHTML = `
          <a href="${videoUrl}" target="_blank" rel="noopener"
             class="inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded text-sm w-fit hover:bg-blue-700 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300">üé• Watch Video</a>`;
        card.innerHTML = `
          ${imgHTML(thumbUrl, item.title)}
          ${titleHTML}
          ${descHTML}
          ${btnHTML}
        `;
      }

      attachFavButton(card, item);
      return card;
    }

    function createAudioCard(item) {
      const card = document.createElement('div');
      card.className = 'tutorial card-ui bg-white rounded-2xl shadow p-4 flex flex-col';
      card.tabIndex = 0;
      card.dataset.id = item.id;
      card.dataset.type = 'audio';
      card.dataset.category = item.category || '';
      card.dataset.section = 'audio';
      card._title = item.title.toLowerCase();
      card.innerHTML = `
        ${imgHTML(item.thumb, item.title)}
        <div class="flex-1">
          <h2 class="text-lg font-bold text-blue-700 mb-1">${item.title}</h2>
          <p class="text-sm text-gray-600 mb-3">${item.description || ''}</p>
          <audio controls class="w-full"><source src="${item.audioUrl}" type="audio/mpeg" /></audio>
        </div>
      `;
      attachFavButton(card, item);
      return card;
    }

    function createPdfCard(item) {
      const card = document.createElement('div');
      card.className = 'tutorial card-ui bg-white rounded-2xl shadow p-4 flex flex-col';
      card.tabIndex = 0;
      card.dataset.id = item.id;
      card.dataset.type = 'pdf';
      card.dataset.category = item.category || '';
      card.dataset.section = 'pdf';
      card._title = item.title.toLowerCase();
      card.innerHTML = `
        ${imgHTML(item.thumb, item.title)}
        <div class="flex-1">
          <h2 class="text-lg font-bold text-blue-700 mb-1">${item.title}</h2>
          <p class="text-sm text-gray-600 mb-3">${item.description || ''}</p>
          <a href="${item.pdfUrl}" target="_blank"
             class="inline-flex items-center gap-2 bg-gray-700 text-white px-4 py-2 rounded text-sm w-fit hover:bg-gray-800 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-300">üìÑ View PDF</a>
        </div>
      `;
      attachFavButton(card, item);
      return card;
    }

    function createCardForItem(item) {
      if (item.type === 'video') return createVideoCard(item);
      if (item.type === 'audio') return createAudioCard(item);
      return createPdfCard(item);
    }

    // Load JSON & build (avec skeletons)
    let allCards = [];
    const sections = { vfix: [], vins: [], vmaint: [], audio: [], pdf: [] };
    const limits = { vfix: STEP, vins: STEP, vmaint: STEP, audio: STEP, pdf: STEP };

    // skeletons avant le fetch
    addSkeletons(containers.vfix, 3);
    addSkeletons(containers.vins, 3);
    addSkeletons(containers.vmaint, 3);
    addSkeletons(containers.audio, 3);
    addSkeletons(containers.pdf, 3);

    try {
      statusMsg.textContent = 'Loading tutorials...';
      const res = await fetch(JSON_PATH, { cache: 'no-store' });
      if (!res.ok) throw new Error('Failed to load JSON');
      items = await res.json();
      items.forEach(it => itemsById.set(it.id, it));

      clearSkeletons();

      items.forEach(item => {
        let card;
        if (item.type === 'video') {
          card = createVideoCard(item);
          const key = (item.vgroup === 'fix') ? 'vfix' : (item.vgroup === 'maintenance') ? 'vmaint' : 'vins';
          sections[key].push(card);
          containers[key].appendChild(card);
        } else if (item.type === 'audio') {
          card = createAudioCard(item);
          sections.audio.push(card);
          containers.audio.appendChild(card);
        } else if (item.type === 'pdf') {
          card = createPdfCard(item);
          sections.pdf.push(card);
          containers.pdf.appendChild(card);
        }
        if (card) allCards.push(card);
      });

      statusMsg.textContent = '';
    } catch (err) {
      console.error(err);
      clearSkeletons();
      statusMsg.className = 'mt-8 text-center text-sm text-red-600';
      statusMsg.textContent = 'Error loading tutorials. Make sure tutorials.json is accessible (serve over http://, not file://).';
      return;
    }

    // Filters & pagination
    function matchesFilters(card) {
      const q = (searchInput?.value || '').toLowerCase();
      const cat = categoryFilter?.value || '';
      const typ = typeFilter?.value || '';
      const title = card._title || (card.querySelector('h2')?.textContent || '').toLowerCase();
      const okSearch = !q || title.includes(q);
      const okCat = !cat || (card.dataset.category === cat);
      const okType = !typ || (card.dataset.type === typ);
      return okSearch && okCat && okType;
    }

    function renderSection(key) {
      const cards = sections[key];
      let shown = 0;
      let totalMatched = 0;

      cards.forEach(card => {
        const isMatch = matchesFilters(card);
        if (!isMatch) { card.style.display = 'none'; return; }
        totalMatched++;
        if (shown < limits[key]) { card.style.display = 'block'; shown++; }
        else { card.style.display = 'none'; }
      });

      const btn = moreBtns[key];
      if (!btn) return;
      btn.style.display = (totalMatched > shown) ? 'inline-block' : 'none';
    }

    function renderAll() {
      renderSection('vfix');
      renderSection('vins');
      renderSection('vmaint');
      renderSection('audio');
      renderSection('pdf');
      renderFavorites();
    }

    function updateFavHeader() {
      const q = (searchInput?.value || '').toLowerCase();
      const cat = categoryFilter?.value || '';
      const typ = typeFilter?.value || '';
      let matched = 0;
      FAVS.forEach(id => {
        const item = itemsById.get(id);
        if (!item) return;
        const title = (item.title || '').toLowerCase();
        const okSearch = !q || title.includes(q);
        const okCat = !cat || item.category === cat;
        const okType = !typ || item.type === typ;
        if (okSearch && okCat && okType) matched++;
      });
      favCount.textContent = matched ? `(${matched})` : '';
      if (favEmpty) favEmpty.style.display = matched ? 'none' : 'block';
    }

    function renderFavorites() {
      const wrap = containers.favs;
      wrap.innerHTML = '';
      const q = (searchInput?.value || '').toLowerCase();
      const cat = categoryFilter?.value || '';
      const typ = typeFilter?.value || '';

      let count = 0;
      FAVS.forEach(id => {
        const item = itemsById.get(id);
        if (!item) return;
        const title = (item.title || '').toLowerCase();
        const okSearch = !q || title.includes(q);
        const okCat = !cat || (item.category === cat);
        const okType = !typ || (item.type === typ);
        if (!(okSearch && okCat && okType)) return;

        const card = createCardForItem(item);
        card.dataset.section = 'favs';
        wrap.appendChild(card);
        count++;
      });

      favCount.textContent = count ? `(${count})` : '';
      if (favEmpty) favEmpty.style.display = count ? 'none' : 'block';
    }

    // Initial render
    renderAll();

    // Filter hooks
    function resetLimits() {
      limits.vfix = STEP; limits.vins = STEP; limits.vmaint = STEP;
      limits.audio = STEP; limits.pdf = STEP;
    }
    function onFilterChange() {
      resetLimits();
      renderAll();
    }
    searchInput?.addEventListener('input', onFilterChange);
    categoryFilter?.addEventListener('change', onFilterChange);
    typeFilter?.addEventListener('change', onFilterChange);

    // Load more handlers
    moreBtns.vfix?.addEventListener('click', () => { limits.vfix += STEP; renderSection('vfix'); });
    moreBtns.vins?.addEventListener('click', () => { limits.vins += STEP; renderSection('vins'); });
    moreBtns.vmaint?.addEventListener('click', () => { limits.vmaint += STEP; renderSection('vmaint'); });
    moreBtns.audio?.addEventListener('click', () => { limits.audio += STEP; renderSection('audio'); });
    moreBtns.pdf?.addEventListener('click', () => { limits.pdf += STEP; renderSection('pdf'); });

    // Clear all favorites
    clearFavsBtn?.addEventListener('click', () => {
      if (!FAVS.size) return;
      const prev = new Set(FAVS);
      FAVS.clear();
      saveFavs(FAVS);
      prev.forEach(id => updateStarUI(id));
      renderFavorites();
      showToast('Favorites cleared', 'warn');
    });
  })();
  </script>
</body>
</html>
